certificates:
  - name: centerionware-pages-default-cert
    secretName: centerionware-pages-default
    issuerRef:
      name: cloudflare-issuer
      kind: ClusterIssuer
    commonName: "centerionware.com"
    dnsNames:
      - "centerionware.com"
      - "*.centerionware.com"
      - "*.pages.centerionware.com"
  - name: centerionware-default
    secretName: centerionware-default
    issuerRef:
      name: cloudflare-issuer
      kind: ClusterIssuer
    commonName: centerionware.com
    dnsNames:
      - centerionware.com
      - '*.centerionware.com'

ingressRoutes:
  - name: ai-centerionware-com-ingressroute
    tls:
      secretName: centerionware-default
      domains:
        - main: "centerionware.com"
          sans:
            - "centerionware.com"
            - "*.centerionware.com"
    routes:
      - kind: Rule
        match: >-
          Host(`ai.centerionware.com`) && PathPrefix(`/`)
        scheme: https
        path: /
        services:
          - type: ExternalName
            name: ai-centerionware-com-service
            externalName: ai-agent-text.centerionware.lan
            ports:
              - name: http
                port: 3002
                targetPort: 3002
        middlewares:
          - authentik@homelab
      - kind: Rule
        match: >-
          Host(`ai.centerionware.com`) && PathPrefix(`/outpost.goauthentik.io/`)
        scheme: https
        path: /
        services:
          - name: auth-forward
            port: 9000
  - name: centerionware-ingress
    tls:
      secretName: centerionware-pages-default
      domains:
        - main: "centerionware.com"
          sans:
            - "centerionware.com"
            - "*.centerionware.com"
            - "*.pages.centerionware.com"
    routes:
      - kind: Rule
        match: >-
          HostRegexp(`(?i)^(alpine|build|sixcloud|cloud)(?:-(?:(runner|www|kiosk|notes|onboarding|helpdesk|sshkey)))?(.*\.)?centerionware\.com$`)
        scheme: https
        path: /
        services:
          - type: ExternalName
            name: centerionware-service
            externalName: gitlab.centerionware.lan
            ports:
              - name: http
                port: 801
                targetPort: 801
        middlewares:
          - alpine-runner-redirectregex
          - build-runner-redirectregex
          - cloud-runner-redirectregex
          - sixcloud-runner-redirectregex
          - kiosk-redirectregex
          - notes-redirectregex
          - onboarding-redirectregex
          - runner-redirectregex
          - sshkey-redirectregex
          - www-redirectregex
      - kind: Rule
        match: >-
          HostRegexp(`(?i)^(.*\.)?pages\.centerionware\.com$`)
        scheme: https
        path: /
        services:
          - type: ExternalName
            name: centerionware-service
            externalName: gitlab.centerionware.lan
            ports:
              - name: http
                port: 801
                targetPort: 801

middlewares:
  - name: resume-auth
    secret: resume-secret

  - name: alpine-runner-redirectregex
    redirectRegex:
      regex: "^https://alpine-runner.centerionware.com"
      replacement: "https://gitlab.centerionware.com/onboarding/initialize-vm/-/raw/main/alpine-runner.sh"

  - name: build-runner-redirectregex
    redirectRegex:
      regex: "^https://build-runner.centerionware.com"
      replacement: "https://gitlab.centerionware.com/onboarding/initialize-vm/-/raw/main/build-runner.sh"

  - name: cloud-runner-redirectregex
    redirectRegex:
      regex: "^https://cloud-runner.centerionware.com"
      replacement: "https://gitlab.centerionware.com/onboarding/initialize-vm/-/raw/main/cloud-runner.sh"

  - name: sixcloud-runner-redirectregex
    redirectRegex:
      regex: "^https://sixcloud-runner.centerionware.com"
      replacement: "https://gitlab.centerionware.com/onboarding/initialize-vm/-/raw/main/cloud-runner6.sh"

  - name: kiosk-redirectregex
    redirectRegex:
      regex: "^https://kiosk.centerionware.com"
      replacement: "https://gitlab.centerionware.com/onboarding/initialize-vm/-/raw/main/kiosk.sh"

  - name: notes-redirectregex
    redirectRegex:
      regex: "^https://notes.centerionware.com"
      replacement: "https://nextcloud.centerionware.com/index.php/apps/notes"

  - name: www-redirectregex
    redirectRegex:
      regex: "^https://www.centerionware.com"
      replacement: "https://centerionware.com"

  - name: onboarding-redirectregex
    redirectRegex:
      regex: "^https://onboarding.centerionware.com"
      replacement: "https://gitlab.centerionware.com/onboarding/initialize-vm/-/raw/main/init.sh"

  - name: runner-redirectregex
    redirectRegex:
      regex: "^https://runner.centerionware.com"
      replacement: "https://gitlab.centerionware.com/onboarding/initialize-vm/-/raw/main/runner.sh"

  - name: sshkey-redirectregex
    redirectRegex:
      regex: "^https://sshkey.centerionware.com"
      replacement: "https://gitlab.centerionware.com/onboarding/initialize-vm/-/raw/main/ssh_key"

  - name: helpdesk-redirectregex
    redirectRegex:
      regex: "^https://helpdesk.centerionware.com"
      replacement: "https://zammad.helpdesk.centerionware.com"

  - name: search-xng-search-centerionware-com-general-security
    headers:
      stsSeconds: 31536000
      stsIncludeSubdomains: true
      stsPreload: true
      browserXssFilter: true
      contentTypeNosniff: true
      referrerPolicy: "no-referrer"

  - name: search-xng-search-centerionware-com-searxng-headers
    headers:
      customResponseHeaders:
        X-Robots-Tag: "noindex, noarchive, nofollow"
        Content-Security-Policy: >-
          upgrade-insecure-requests; default-src 'none'; script-src 'self'; style-src 'self' 'unsafe-inline'; form-action 'self' https://github.com/searxng/searxng/issues/new; font-src 'self'; frame-ancestors 'self'; base-uri 'self'; connect-src 'self' https://overpass-api.de; img-src 'self' data: https://*.tile.openstreetmap.org; frame-src https://www.youtube-nocookie.com https://player.vimeo.com https://www.dailymotion.com https://www.deezer.com https://www.mixcloud.com https://w.soundcloud.com https://embed.spotify.com
        Permissions-Policy: >-
          accelerometer=(),ambient-light-sensor=(),autoplay=(),camera=(),encrypted-media=(),focus-without-user-activation=(),geolocation=(),gyroscope=(),magnetometer=(),microphone=(),midi=(),payment=(),picture-in-picture=(),speaker=(),sync-xhr=(),usb=(),vr=()

  - name: authentik
    forwardAuth:
      address: "http://ak-outpost-all-proxy-outpost.authentik.svc.cluster.local:9000/outpost.goauthentik.io/auth/traefik"
      trustForwardHeader: true
      authResponseHeaders:
        - X-authentik-username
        - X-authentik-groups
        - X-authentik-entitlements
        - X-authentik-email
        - X-authentik-name
        - X-authentik-uid
        - X-authentik-jwt
        - X-authentik-meta-jwks
        - X-authentik-meta-outpost
        - X-authentik-meta-provider
        - X-authentik-meta-app
        - X-authentik-meta-version